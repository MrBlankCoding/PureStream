<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PureStream | Viewer</title>
    <meta name="description" content="Real-time collaborative screen sharing with low-latency WebRTC streaming">

    <link rel="stylesheet" href="/src/styles.css">
</head>

<body class="h-screen flex flex-col overflow-hidden bg-black">

    <div id="toast-container"
        class="fixed top-12 left-1/2 transform -translate-x-1/2 z-50 flex flex-col gap-2 pointer-events-none"></div>

    <!-- Main Container -->
    <div class="h-screen flex flex-col bg-black overflow-hidden relative">

        <!-- Center Stage -->
        <div class="flex-1 flex relative overflow-hidden">

            <!-- Video/Whiteboard Area -->
            <div id="video-stage" class="flex-1 flex items-center justify-center bg-black relative">

                <!-- Empty State -->
                <div id="empty-state" class="text-center space-y-4">
                    <div class="w-16 h-16 bg-[#222] rounded-full flex items-center justify-center mx-auto">
                        <i data-lucide="monitor" class="w-8 h-8 text-gray-500"></i>
                    </div>
                    <p id="status-message" class="text-gray-500">Waiting for screen share...</p>
                </div>

                <!-- Remote Video -->
                <video id="remote-video" autoplay playsinline class="hidden w-full h-full object-contain"></video>

                <!-- Whiteboard Container -->
                <div id="whiteboard-container"
                    class="hidden absolute inset-0 bg-white rounded-lg shadow-2xl overflow-hidden z-20 flex flex-col relative">
                    <!-- Toolbar -->
                    <div id="whiteboard-toolbar"
                        class="absolute bottom-6 left-1/2 transform -translate-x-1/2 bg-[#222] border border-[#333] rounded-full px-4 py-2 flex items-center gap-4 shadow-xl z-50">

                        <!-- Tools -->
                        <div class="flex items-center gap-2 border-r border-[#444] pr-4">
                            <button id="wb-tool-select"
                                class="p-2 rounded-full hover:bg-[#333] text-gray-400 hover:text-white transition-colors active-tool"
                                title="Select">
                                <i data-lucide="mouse-pointer-2" class="w-5 h-5"></i>
                            </button>
                            <button id="wb-tool-pen"
                                class="p-2 rounded-full hover:bg-[#333] text-gray-400 hover:text-white transition-colors"
                                title="Pen">
                                <i data-lucide="pen" class="w-5 h-5"></i>
                            </button>
                            <button id="wb-tool-highlighter"
                                class="p-2 rounded-full hover:bg-[#333] text-gray-400 hover:text-white transition-colors"
                                title="Highlighter">
                                <i data-lucide="highlighter" class="w-5 h-5"></i>
                            </button>
                            <button id="wb-tool-text"
                                class="p-2 rounded-full hover:bg-[#333] text-gray-400 hover:text-white transition-colors"
                                title="Text">
                                <i data-lucide="type" class="w-5 h-5"></i>
                            </button>
                            <button id="wb-tool-eraser"
                                class="p-2 rounded-full hover:bg-[#333] text-gray-400 hover:text-white transition-colors"
                                title="Eraser">
                                <i data-lucide="eraser" class="w-5 h-5"></i>
                            </button>
                        </div>

                        <!-- Colors -->
                        <div class="flex items-center gap-2 border-r border-[#444] pr-4">
                            <button
                                class="wb-color-btn w-6 h-6 rounded-full bg-black border-2 border-white ring-2 ring-transparent hover:ring-blue-500 transition-all"
                                data-color="#000000" title="Black"></button>
                            <button
                                class="wb-color-btn w-6 h-6 rounded-full bg-red-500 border-2 border-transparent hover:border-white transition-all transform hover:scale-110"
                                data-color="#ef4444" title="Red"></button>
                            <button
                                class="wb-color-btn w-6 h-6 rounded-full bg-blue-500 border-2 border-transparent hover:border-white transition-all transform hover:scale-110"
                                data-color="#3b82f6" title="Blue"></button>
                            <button
                                class="wb-color-btn w-6 h-6 rounded-full bg-green-500 border-2 border-transparent hover:border-white transition-all transform hover:scale-110"
                                data-color="#22c55e" title="Green"></button>
                            <button
                                class="wb-color-btn w-6 h-6 rounded-full bg-orange-500 border-2 border-transparent hover:border-white transition-all transform hover:scale-110"
                                data-color="#f97316" title="Orange"></button>
                        </div>

                        <!-- Brush Size -->
                        <div class="flex items-center gap-2 border-r border-[#444] pr-4">
                            <input type="range" id="wb-brush-size" min="1" max="50" value="3"
                                class="w-20 h-1 bg-gray-600 rounded-lg appearance-none cursor-pointer">
                            <span id="wb-brush-size-label" class="text-xs text-gray-400 w-6 text-center">3</span>
                        </div>

                        <!-- Actions -->
                        <div class="flex items-center gap-2">
                            <button id="wb-action-download"
                                class="p-2 rounded-full hover:bg-[#333] text-gray-400 hover:text-white transition-colors"
                                title="Download Image">
                                <i data-lucide="download" class="w-5 h-5"></i>
                            </button>
                            <button id="wb-action-clear"
                                class="p-2 rounded-full hover:bg-[#333] text-red-400 hover:text-red-500 transition-colors"
                                title="Clear Board">
                                <i data-lucide="trash-2" class="w-5 h-5"></i>
                            </button>
                        </div>

                    </div>
                </div>

                <!-- Self View (Floating) -->
                <div id="local-preview"
                    class="hidden absolute top-4 right-4 w-48 aspect-video bg-black border border-[#333] rounded shadow-lg overflow-hidden z-20">
                    <video id="local-preview-video" autoplay playsinline muted
                        class="w-full h-full object-cover"></video>
                </div>
            </div>

            <!-- Sidebars (Participants & Chat) - Now integrated or overlay -->
            <!-- Participants Sidebar -->
            <aside id="sidebar"
                class="hidden md:flex flex-col w-80 bg-[#1a1a1a] border-l border-[#333] z-30 absolute right-0 inset-y-0 transform translate-x-full transition-transform duration-300 md:relative md:translate-x-0 md:w-0 md:border-l-0 overflow-hidden">
                <div class="flex items-center justify-between p-4 border-b border-[#333]">
                    <h2 class="text-white font-medium">Participants</h2>
                    <button id="close-sidebar-btn" class="text-gray-400 hover:text-white"><i data-lucide="x"
                            class="w-4 h-4"></i></button>
                </div>
                <div class="p-4 border-b border-[#333]">
                    <div class="flex items-center gap-2 bg-[#222] p-2 rounded cursor-pointer hover:bg-[#333] transition-colors"
                        id="copy-room-id">
                        <span id="room-id-display" class="font-mono text-xs text-blue-400">...</span>
                        <i data-lucide="copy" class="w-3 h-3 text-gray-400 ml-auto"></i>
                    </div>
                </div>
                <div class="flex-1 overflow-y-auto p-2">
                    <div id="user-list" class="space-y-1"></div>
                </div>
            </aside>

            <!-- Chat Sidebar -->
            <aside id="chat-sidebar"
                class="hidden md:flex flex-col w-80 bg-[#1a1a1a] border-l border-[#333] z-30 absolute right-0 inset-y-0 transform translate-x-full transition-transform duration-300 md:relative md:translate-x-0 md:w-0 md:border-l-0 overflow-hidden">
                <div class="flex items-center justify-between p-4 border-b border-[#333]">
                    <h2 class="text-white font-medium">Chat</h2>
                    <button id="close-chat-btn" class="text-gray-400 hover:text-white"><i data-lucide="x"
                            class="w-4 h-4"></i></button>
                </div>
                <div id="chat-messages" class="flex-1 overflow-y-auto p-4 space-y-3"></div>
                <form id="chat-form" class="p-4 border-t border-[#333] bg-[#1f1f1f]">
                    <input id="chat-input" type="text" autocomplete="off"
                        class="w-full bg-[#2a2a2a] border border-[#333] rounded px-3 py-2 text-sm text-white focus:outline-none focus:border-blue-500"
                        placeholder="Type a message..." />
                </form>
            </aside>

        </div>

        <!-- Bottom Control Bar -->
        <div class="h-16 bg-[#1a1a1a] border-t border-[#333] flex items-center justify-between px-4 z-40 relative">

            <!-- Left: Audio Controls -->
            <div class="flex items-center gap-2">
                <button id="join-call-btn"
                    class="flex flex-col items-center justify-center p-2 rounded hover:bg-[#333] text-gray-400 w-16 gap-1 group">
                    <i data-lucide="headphones" class="w-5 h-5 group-hover:text-white transition-colors"></i>
                    <span class="text-[10px]">Join Audio</span>
                </button>
                <div id="call-controls" class="hidden flex items-center gap-2">
                    <button id="mute-btn"
                        class="flex flex-col items-center justify-center p-2 rounded hover:bg-[#333] text-gray-400 w-16 gap-1 group">
                        <i data-lucide="mic" class="w-5 h-5 group-hover:text-white transition-colors"></i>
                        <span class="text-[10px]">Mute</span>
                    </button>
                    <button id="deafen-btn"
                        class="flex flex-col items-center justify-center p-2 rounded hover:bg-[#333] text-gray-400 w-16 gap-1 group">
                        <i data-lucide="volume-2" class="w-5 h-5 group-hover:text-white transition-colors"></i>
                        <span class="text-[10px]">Deafen</span>
                    </button>
                </div>
            </div>

            <!-- Center: Sharing Controls -->
            <div class="flex items-center gap-4 absolute left-1/2 transform -translate-x-1/2">

                <button id="share-screen-btn"
                    class="flex flex-col items-center justify-center p-2 rounded hover:bg-[#333] text-green-500 w-16 gap-1">
                    <div class="bg-green-500/10 p-1 rounded-full"><i data-lucide="monitor-up" class="w-5 h-5"></i></div>
                    <span class="text-[10px] font-semibold">Share</span>
                </button>
                <button id="stop-share-btn"
                    class="hidden flex flex-col items-center justify-center p-2 rounded hover:bg-[#333] text-red-500 w-16 gap-1">
                    <div class="bg-red-500/10 p-1 rounded-full"><i data-lucide="square" class="w-5 h-5"></i></div>
                    <span class="text-[10px] font-semibold">Stop</span>
                </button>

                <button id="start-whiteboard-btn"
                    class="flex flex-col items-center justify-center p-2 rounded hover:bg-[#333] text-white w-16 gap-1 group">
                    <i data-lucide="pen-tool" class="w-5 h-5 group-hover:text-blue-400 transition-colors"></i>
                    <span class="text-[10px]">Whiteboard</span>
                </button>
                <button id="stop-whiteboard-btn"
                    class="hidden flex flex-col items-center justify-center p-2 rounded hover:bg-[#333] text-red-500 w-16 gap-1">
                    <i data-lucide="x-circle" class="w-5 h-5"></i>
                    <span class="text-[10px]">Close</span>
                </button>

            </div>

            <!-- Right: Toggles & Leave -->
            <div class="flex items-center gap-2">
                <button id="mobile-participants-btn"
                    class="flex flex-col items-center justify-center p-2 rounded hover:bg-[#333] text-gray-400 w-16 gap-1 group">
                    <div class="relative">
                        <i data-lucide="users" class="w-5 h-5 group-hover:text-white transition-colors"></i>
                        <!-- Badge could go here -->
                    </div>
                    <span class="text-[10px]">People</span>
                </button>

                <button id="mobile-chat-btn"
                    class="flex flex-col items-center justify-center p-2 rounded hover:bg-[#333] text-gray-400 w-16 gap-1 group">
                    <i data-lucide="message-square" class="w-5 h-5 group-hover:text-white transition-colors"></i>
                    <span class="text-[10px]">Chat</span>
                </button>

                <button id="fullscreen-btn"
                    class="flex flex-col items-center justify-center p-2 rounded hover:bg-[#333] text-gray-400 w-16 gap-1 group">
                    <i data-lucide="maximize" class="w-5 h-5 group-hover:text-white transition-colors"></i>
                    <span class="text-[10px]">View</span>
                </button>

                <button id="leave-btn"
                    class="ml-4 bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded text-sm font-medium transition-colors">
                    End
                </button>
            </div>

        </div>

        <!-- User/Self Info Overlay (Bottom Left of Video Stage) -->
        <div class="absolute bottom-20 left-4 z-20 flex items-center gap-2">
            <div
                class="bg-black/50 backdrop-blur px-3 py-1 rounded-full border border-white/10 text-white text-xs flex items-center gap-2">
                <div class="w-2 h-2 rounded-full bg-green-500"></div>
                <span id="my-username">Me</span>
            </div>
        </div>

    </div>

    <!-- Mobile/Floating sidebars trigger logic will handle the 'hidden' classes or width changes -->
    <script type="module" src="/src/viewer.ts"></script>

</body>

</html>